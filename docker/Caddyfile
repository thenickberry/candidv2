:80 {
    root * /var/www/public

    # Security headers
    header {
        X-Content-Type-Options "nosniff"
        X-Frame-Options "SAMEORIGIN"
        X-XSS-Protection "1; mode=block"
    }

    # Deny access to hidden files
    @hidden path /.*
    respond @hidden 404

    # Strip trailing slashes (except root)
    @trailing_slash path_regexp trailing ^(.+)/$
    redir @trailing_slash {re.trailing.1} permanent

    # Cache static assets
    @static path *.jpg *.jpeg *.png *.gif *.ico *.css *.js *.svg *.woff *.woff2 *.ttf *.eot
    header @static Cache-Control "public, max-age=86400, immutable"

    # Enable gzip compression
    encode gzip

    # PHP-FPM
    php_fastcgi app:9000 {
        read_timeout 300s
    }

    # Serve static files, fallback to PHP
    file_server

    # Log errors
    log {
        output stderr
    }
}
